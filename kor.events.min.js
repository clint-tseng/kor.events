(function(){function o(a){var b,c=d.key||"_kor_events_key";if(e(a.jquery)){if(e(b=a[c]))b=a[c]=g++}else if(e(b=a.data(c)))a.data(c,b=g++);return b}function p(){var a=0,b=!1;arguments[0]===!0&&(a++,b=!0);for(var c=arguments[a++];a<arguments.length;a++){var f=arguments[a];if(e(c[f]))if(b)c[f]={};else return;c=c[f]}return c}function t(a){if(a==null)return 0;var b=0,c;for(c in a)b++;return b}function q(a,b){var c=b||[];if(a!=null)for(var e in a)c.push(a[e]);return c}function e(a){return a===void 0}var r=
{},l={},h={},g=0,d={listen:function(a){var b=a.subject,c=a.verb,f=a.args,m=g++,a={s:b,v:c,p:a.priority,a:f,i:m,c:a.callback},b=e(b)?r:p(!0,l,o(b)),d=b[c];e(d)&&(d=b[c]={all:{},arg:{}});if(!e(f))for(var i in f)p(!0,d,"arg",i)[m]=a;d.all[m]=a;h[m]=a;return m}},v=d.fire=function(a){if(e(a))throw Error("need to provide options to fire on!");var b=a.subject,c=a.verb,f=a.args;if(c==null)throw Error("need to provide a verb at minimum!");var d={},h=p(r,c)||{all:{},arg:{}},i=q(h.all);if(!e(b)){var n=o(b),
n=p(l,n,c);e(n)||q(n.all,i)}if(i.length===0)return!0;if(!e(f))for(var s in f){var c=f[s],g=q(h.arg[s]);e(b)||q(n.arg[s],g);for(var j=0;j<g.length;j++){var k=g[j];c===k.a[s]&&(d[k.i]=(d[k.i]||0)+1)}}i.sort(function(a,b){var c=(b.p||t(b.a))-(a.p||t(a.a));return c!==0?c:a.i-b.i});for(j=0;j<i.length;j++)if(k=i[j],!((d[k.i]||0)<t(k.a))&&k.c(a)===!1)return!1;return!0};d.derez=function(a){var b=v({subject:a,verb:"derez"});delete l[o(a)];return b};d.unlisten=function(a){var b=h[a];if(e(b))throw Error("No event found by this id!");
var c;c=e(b.s)?r[b.v]:l[o(b.s)][b.v];delete c.all[a];for(var d in b.args)delete c.arg[d][id];delete h[a];return b};d.unlistenAll=function(){r={};l={};h={}};if(typeof module!=="undefined"&&module.exports)module.exports=d;else{var u=this.kor;e(u)&&(u=this.kor={});u.events=d}})();
