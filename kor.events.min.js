var l=true;
(function(){function o(a){var b,c=g.key||"_kor_events_key";if(d(a.jquery)){if(d(b=a[c]))b=a[c]=t++}else if(d(b=a.data(c)))a.data(c,b=t++);return b}function p(){var a=0,b=false;if(arguments[0]===l){a++;b=l}for(var c=arguments[a++];a<arguments.length;a++){var e=arguments[a];if(d(c[e]))if(b)c[e]={};else return;c=c[e]}return c}function u(a){if(a==null)return 0;var b=0,c;for(c in a)b++;return b}function q(a,b){var c=b||[];if(a!=null)for(var e in a)c.push(a[e]);return c}function d(a){return a===void 0}
var r={},m={},v={},t=0,g={};g.listen=function(a){var b=a.subject,c=a.verb,e=a.args,f=t++;a={s:b,v:c,p:a.priority,a:e,i:f,c:a.callback};b=d(b)?r:p(l,m,o(b));var h=b[c];if(d(h))h=b[c]={all:{},arg:{}};if(!d(e))for(var i in e)p(l,h,"arg",i)[f]=a;h.all[f]=a;v[f]=a;return f};var B=g.fire=function(a){if(d(a))throw Error("need to provide options to fire on!");var b=a.subject,c=a.verb,e=a.args;if(c==null)throw Error("need to provide a verb at minimum!");var f={},h=p(r,c)||{all:{},arg:{}},i=q(h.all);if(!d(b)){var n=
o(b);n=p(m,n,c);d(n)||q(n.all,i)}if(i.length===0)return l;if(!d(e))for(var s in e){c=e[s];var w=q(h.arg[s]);d(b)||q(n.arg[s],w);for(var j=0;j<w.length;j++){var k=w[j];if(c===k.a[s])f[k.i]=(f[k.i]||0)+1}}i.sort(function(x,y){var z=(y.p||u(y.a))-(x.p||u(x.a));if(z!==0)return z;return x.i-y.i});for(j=0;j<i.length;j++){k=i[j];if(!((f[k.i]||0)<u(k.a)))if(k.c(a)===false)return false}return l};g.derez=function(a){var b=B({subject:a,verb:"derez"});delete m[o(a)];return b};g.unlisten=function(a){var b=v[a];
if(d(b))throw Error("No event found by this id!");var c;c=d(b.s)?r[b.v]:m[o(b.s)][b.v];delete c.all[a];for(var e in b.args)delete c.arg[e][id];delete v[a];return b};g.unlistenAll=function(){r={};m={}};if(typeof module!=="undefined"&&module.exports)module.exports=g;else{var A=this.kor;if(d(A))this.kor={};A.events=g}})();
